sudo: required
language: node_js
node_js: '8'
cache:
  apt: true
  directories:
  - node_modules
  - packages/healy-utility/node_modules
  - packages/healy-widget/node_modules
  - packages/healy-widget/bower_components
  - "$HOME/.npm"
addons:
  apt:
    sources:
      - google-chrome
    packages:
      - coreutils
      - google-chrome-stable
before_install:
  - mkdir -p /tmp/git-lfs && curl -L https://github.com/github/git-lfs/releases/download/v2.2.0/git-lfs-$([ "$TRAVIS_OS_NAME" == "linux" ] && echo "linux" || echo "darwin")-amd64-2.2.0.tar.gz | tar -xz -C /tmp/git-lfs --strip-components 1 && /tmp/git-lfs/git-lfs pull
  - npm install -g bower
  - npm install -g lerna@^2
  - lerna bootstrap
before_script:
  - echo "$GOOGLE_CREDENTIALS_BASE64" | base64 --decode > google-application-credentials.json
script:
  # Run our tests with virtual X frame buffer, needed for the selenium browser tests
  - xvfb-run npm test
after_success: npm run coverage
dist: trusty
